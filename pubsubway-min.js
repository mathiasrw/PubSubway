var pubsubway=function(){var a=this,f={},k=!1,l=!1;a.subways=[];a.log=function(a,c){k&&100>=c&&console.log("pub/sub: "+a)};a.voidAction=function(a){l=a?!0:!1};a.doLog=function(a){k=a?!0:!1};a.publish=a.yell=a.pub=function(b,c){if(b instanceof Array)for(var d=0;d<b.length;d++)a.publish(b[d],c);if(l)return a.log("void: "+b,99);a.log(b,100);c=c||[];c=h(c);return f[b]&&this.each(f[b],function(){this.apply(a,c)})?!0:!1};a.subscribeANDmodeRewind=a.whenREWIND=a.subREWIND=function(b,c,d){a.subscribe(b,c,
d,"ANDmodeRewind")};a.subscribeANDmodeContinues=a.whenAND=a.subAND=function(b,c,d){a.subscribe(b,c,d,"ANDmodeContinues")};a.subscribeANDmodeOnce=a.whenAND1=a.subAND1=function(b,c,d){a.subscribe(b,c,d,"ANDmodeOnce")};a.subscribeORmodeButNotIfButResetWith=a.whenORBUT=a.subORBUT=function(b,c,d,g,e){b=h(b);c=h(c);d=h(d);var f=[];f[0]=b;f[1]=c;f[2]=d;a.subscribe(f,g,e,"ORmodeButNotIfButResetWith")};a.subscribe=a.whenOR=a.subOR=a.when=a.sub=function(b,c,d,g){d=d||!1;g=g||null;null==g||b instanceof Array||
(b=[b]);if(!(b instanceof Array))return f[b]||(f[b]=[]),d?f[b].unshift(c):f[b].push(c),[b,c];if(null==g)return a.each(b,function(){a.subscribe(this,c,g,d)}),[b,c];var e=b.join("#")+"#"+Math.random();a.subways[e]={};a.subways[e].mux=[];a.subways[e].dontRun=!1;a.subways[e].handlers=[];a.subways[e].handlers.push(a.subscribe(e,c));for(var h in b)a.subways[e].mux[b[h]]=1;switch(g){case "ANDmodeRewind":a.each(b,function(c){c=this;var d=a.subscribe(c,function(){var d=a.subways[e].mux[c]=0,f;for(f in b)d+=
a.subways[e].mux[b[f]];if(0==d)for(f in a.publish(e),b)a.subways[e].mux[b[f]]=1});a.subways[e].handlers.push(d)});break;case "ANDmodeContinues":a.each(b,function(c){c=this;var d=a.subscribe(c,function(){var d=a.subways[e].mux[c]=0,f;for(f in b)d+=a.subways[e].mux[b[f]];0==d&&a.publish(e)});a.subways[e].handlers.push(d)});break;case "ANDmodeOnce":a.each(b,function(c){c=this;var d=a.subscribe(c,function(){if(!a.subways[e].dontRun){var d=a.subways[e].mux[c]=0,f;for(f in b)d+=a.subways[e].mux[b[f]];0==
d&&(a.publish(e),a.subways[e].dontRun=!0)}});a.subways[e].handlers.push(d)});break;case "ORmodeButNotIfButResetWith":if(!(0 in b&&b[0]instanceof Array&&1 in b&&b[1]instanceof Array&&2 in b&&b[2]instanceof Array))return console.log("Wrong pubsub formatting of ORmodeButNotIfButResetWith"),!1;h=b[0];var k=b[1];a.each(b[2],function(b){b=a.subscribe(this,function(){a.subways[e].dontRun=!1});a.subways[e].handlers.push(b)});a.each(k,function(b){b=a.subscribe(this,function(){a.subways[e].dontRun=!0});a.subways[e].handlers.push(b)});
a.each(h,function(b){b=a.subscribe(this,function(){a.subways[e].dontRun||a.publish(e)});a.subways[e].handlers.push(b)});break;default:return a.log("Wrong mode setting in pubsubway: "+g,1),!1}return[e,c]};a.unsubscribe=a.unsub=function(b){var c=b[0];f[c]&&a.each(f[c],function(a){this==b[1]&&f[c].splice(a,1)})};a.each=function(a,c){for(var d=-1,f=a.length;++d<f&&!1!==c.call(el=a[d],d,el););};var h=function(a){return a instanceof Array?a:[a]};a.pubsubBack=function(b){b=b||function(){};if(!(b instanceof
Function)){var c=b;b=function(){a.publish(c,arguments)}}return b};return a}();module=module||{};module.exports=pubsubway;
